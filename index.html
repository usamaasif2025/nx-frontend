<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Phase 1 Ticker</title>
    <style>
      body { font-family: Arial, sans-serif; padding: 20px; }
      input { padding: 10px; font-size: 16px; }
      button { padding: 10px 14px; font-size: 16px; cursor: pointer; }
      .card { margin-top: 16px; padding: 14px; border: 1px solid #ddd; border-radius: 10px; }
      .yes { color: #0a7a0a; font-weight: bold; }
      .no { color: #b00020; font-weight: bold; }
      pre { background: #f6f6f6; padding: 10px; border-radius: 8px; overflow: auto; }
    </style>
  </head>
  <body>

    <input id="ticker" placeholder="TSLA" />
    <button id="btn">Check</button>

    <div id="result" class="card" style="display:none;"></div>
    <pre id="raw" style="display:none;"></pre>

    <script>
      const tickerEl = document.getElementById("ticker");
      const btn = document.getElementById("btn");
      const resultEl = document.getElementById("result");
      const rawEl = document.getElementById("raw");

      function fmtPct(x) {
        return (x * 100).toFixed(2) + "%";
      }

      btn.addEventListener("click", async () => {
        const t = tickerEl.value.trim().toUpperCase();
        resultEl.style.display = "none";
        rawEl.style.display = "none";
        resultEl.innerHTML = "Loading...";

        if (!t) return;

        try {
          const r = await fetch(`/api/check?ticker=${encodeURIComponent(t)}`);
          const data = await r.json();

          if (!r.ok) {
            resultEl.style.display = "block";
            resultEl.innerHTML = `<strong>Error:</strong> ${data.error || "Unknown error"}`;
            return;
          }

          const statusClass = data.meetsRule ? "yes" : "no";
          const statusText = data.meetsRule ? "YES" : "NO";

          resultEl.style.display = "block";
          resultEl.innerHTML = `
            <div><strong>${data.ticker}</strong> — <span class="${statusClass}">${statusText}</span> (≥ ${(data.threshold*100).toFixed(0)}%)</div>
            <div>Current: <strong>$${data.current}</strong></div>
            <div>Prev Close: $${data.prevClose}</div>
            <div>% Change: ${fmtPct(data.pctChange)}</div>
            <div>Open: $${data.open} | High: $${data.high} | Low: $${data.low}</div>
            <div>Time: ${data.timestamp || "N/A"}</div>
          `;

          rawEl.style.display = "block";
          rawEl.textContent = JSON.stringify(data, null, 2);
        } catch (e) {
          resultEl.style.display = "block";
          resultEl.innerHTML = `<strong>Error:</strong> ${e}`;
        }
      });
    </script>
  </body>
</html>

